---
title: "R Tutorial - Baby Name Data"
author: "Jon Wheeler"
date: "2022-11-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Getting to Know R and RStudio

Let's set up a workspace. There are a few different ways of doing this, and
different operating systems may behave differently in terms of navigating
the file system, application permissions, etc.

**Option 1**

1. Download the entire tutorial code repository from GitHub as a zipfile:
<https://github.com/unmrds/cc-R-RStudio/archive/refs/heads/master.zip>
2. Extract the contents of the zipfile to your preferred working directory -
Documents, Desktop, etc.
3. Open the extracted directory, *cc-R-RStudio*, and clicks on the RStudio
project file, *cc-R-RStudio.Rproj*.
4. Within the **Files** pane in RStudio, click on the directory 'cc-R-Names'
to open it.
5. Click on the *More* button in the **Files** pane and select the option to
"Set as Working Directory."

**Option 2**

1. Launch RStudio from your operating system's application menu.
2. The context of the application - the directory it opens into - is most
likely your home directory. It can be difficult to navigate out of this
directory in Windows, so we recommend continuing in this directory if you
use this option.
3. Using the *New Folder* button in RStudio's **Files** pane, create a new
folder named 'cc-R-Names.'
4. Within the **Files** pane in RStudio, click on the new folder to open it.
5. Click on the *More* button in the **Files** pane and select the option to
"Set as Working Directory."

### The Console

R is an interpreted language. Code does not have to be compiled in order to 
run - instead we use an interpreter (vanilla R or the console in RStudio) 
to execute code on the fly.

We can demonstrate this by using the console as a calculator.

```{r intro_console}
12 + 12
12 * 12
12 ** 2
144 - 12
144 / 12
```
The console will also echo strings or simple numeric values. 

```{r console_echo}
12
'twelve'
'Greetings from Earth!'
```
Note that strings need to be enclosed in quotes. Notice what happens when we
try to execute the following:

```{r str_error, eval=FALSE}
twelve
```
The term *object* in R is synonymous with *variable*. The
error message is telling us there is no object or variable named 'twelve' in
the current environment.

#### Exercise: Please Excuse My Dear Aunt Sally

Something to keep in mind as you code calculations is that mathematical
operations in R follow the standard order of operation (PEMDAS).

What will be the result of the following command? Test your answer by running
the command in the console.

How can we change the command to get a result of 42?

```{r exercise_1}
10 - 3 * 6
```

### Objects (Variables)

We assign values to objects in R using the *<-* operator. The keyboard shortcut
for this is **ALT -**. 

```{r assignment}
exponent = 2
gross <- 12 ** exponent
gross_squared <- gross ** exponent
```

Objects can also have string values.

```{r str_assignment}
pet <- 'gecko'
```

We can check the data type of an object using the ```class()``` function. We
will look more closely at data types later.

```{r types}
class(exponent)
class(pet)
```

### The Environment Tab

When we previously executed mathematical operations, the output was printed
to the console. Notice that when we assign values to objects, the value of the
object is not printed to the console but is instead displayed in RStudio's
**Environment** tab.

As we develop workflows, it can be helpful to monitor changes to object values.
This is useful especially when we update the values of objects in place.

```{r update_inplace}
my_age <- 18
my_age <- my_age + 1 # Happy birthday!
my_age <- my_age - 4 # This might not be valid.
```

The **Environment** tab provides information about different types of objects
and data structures.

### The Script Pane

So far we have been working in the console, which is great for testing
commands, installing packages, getting help, and other things you may only
want to try out or which don't belong in a script.

Often however, we will do most of our work by running scripts. That's one of
the advantages of using R - scripts allow us to build scalable, reproducible
workflows.

For the remainder of this tutorial, we are mainly going to use an R script 
rather than the console.

#### Exercise: Sanity check.

Let's make sure our working directory is defined so that we can all use the
same example code and paths to read data.

The following command will output the path from the root of your filesystem
to the working directory. Everyone's path will be different, but all of our
paths should end with 'cc-R-Names.'

If your path ends with something different, please let us know.

```{r wd_check}
# Get working directory
getwd()
```

#### Exercise: History Repeats Itself

Our first script is going to demonstrate some time-saving features of RStudio.
In particular, once we have tested some code in the console, the **History** tab
gives us a way to automatically copy it to a script.

1. Use the green "plus" icon to create a new file. Alternatively, use the
menu commands: File -> New File -> R Script. You can also use the keyboard
shortcut *CTL+SHIFT+N*.
2. In the console, create an object ```distance_k``` and assign it a value.
3. Still in the console, create a second object, ```k_m_ratio``` and assign it
the value 0.62.
4. Create a third object, ```distance_m``` and define it as the product of
```distance_k``` \* ```k_m_ratio```.
5. Enter the object name, ```distance_m``` to see the value of the object.

Note that we can use code completion to reduce the amount of typing.

We have working code to convert distances in kilometers to miles, but reusing
it as-is is cumbersome. Instead, we add the code to our new script file and
convert arbitrary distances by changing the value of ```distance_k``` and
running the script.

1. Select the open script tab in the script pane.
2. Select the **History** tab in the top right pane.
3. Scroll down as needed to our conversion code.
4. Highlight a line of code and select **To Source** to copy the code to our
script file. Do this for each line of code we want to reuse.
5. **IMPORTANT!** Save the script - RStudio does not 'save' files on creation.
6. Run the script using the **Source** button. Alternatively, highlight the
script and use the **Run** button to run the highlighted code.
7. Wrap the last line in a ```print()``` function to output the value of 
```distance_m``` to the console.

#### Exercise: Improved Accuracy

The value of the ```k_m_ratio``` used above is rounded to the second decimal
place. A more accurate conversion can be achieved by including more decimal
places. The ratio out to 6 decimal places is 0.621371. Try the following:

1. Update the value of ```k_m_ratio``` to a different decimal place.
2. Add new lines of code to complete a round trip conversion from miles
back to kilometers.
3. Convert the result of the round trip conversion to meters.

Be sure to save your script often!

## Working with Data

The dataset we are using for this tutorial consists of baby names as
registered with the US Social Security Administration. 

> Social Security Administration (2022). "Baby Names from Social Security 
Card Applications - National Data." Accessed from <https://catalog.data.gov/dataset/baby-names-from-social-security-card-applications-national-data>

The data have been modified to add column names, which are not included in
the source data. Data from 2010-2021 have been included in the dataset, with
a file for each year.

The dataset can be accessed different ways. 

**Option 1**

1. If you downloaded the full repository from GitHUb earlier, the data were
included in the zipfile, Looking at the **Files** tab in the lower right
hand pane in RStudio, there should be a *data* directory. The baby name 
data files are in this directory.
2. Please note that you can ignore the file "data.zip," as the data have
already been extracted into the *data* directory if you used this option.

**Option 2**

1. Download the file "data.zip" from the GitHub repository.
<https://github.com/unmrds/cc-R-RStudio/raw/master/cc-R-Names/data.zip>
2. Extract the contents of the zipfile into the working directory. There are
a few different ways to do this. A method that will work on most operating
systems is:
  1. Double click the zipfile to open it.
  2. Right click and copy the 'data' directory inside the zipfile. You can also
  highlight the directory with your cursor and type CONTROL+C to copy it.
  3. Using your system's file management GUI, navigate to the 'cc-R-Names'
  directory we've set as our working directory. Right-click and select 'paste'
  to paste the data directory into the working directory. Alternatively, you
  can use CONTROL-V to paste.
  

#### Exercise: Got Data?

Let's confirm that we all have the data in a place where we can use the same
path in our scripts to read the data files.

The output of the following command should be 

> [1] "2010" "2011" "2012" "2013" "2014" "2015" "2016" "2017" "2018" "2019"
"2020" "2021"

Please let us know if you get a different output.

```{r check_data}
list.files("./data/")
```
### R Packages

One of the strengths of R is the large community of users and the number of 
community-developed packages that add functionality to the base environment.

For our analysis of baby names, we're going to use some of the more popular
packages for data science and visualization. If we're using R and RStudio for
the first time, it's likely that these packages will need to be installed.

We will install 3 packages:

* readr
* dplyr
* ggplot2

If you have previously installed the *tidyverse,* then you already have these
packages. 

We can install, verify, and load packages in the **Packages** tab in the 
lower right pane of RStudio. We can also use the following commands - note 
however that the ```install.packages``` command should be run in the console 
and not included in scripts.

```{r install_packages, eval=FALSE, include=FALSE}
install.packages('readr')
install.packages('dplyr')
install.packages('ggplot2')
```
It may take a moment for the packages to install. If you have not already 
installed the tidyverse, we do recommend doing that sometime after this
workshop. However, it's a large meta-package that can take a while to install,
so we prefer to work with the individual packages during workshops.

Once we have installed packages, we need to load them into our environment.
This is something we definitely want to include in our scripts. Let's create a
new blank script file and save it in our working directory as 'baby_names.R.'

Add these lines:

```{r load_packages, include=False}
library(readr)
library(dplyr)
library(ggplot2)
```

After running these lines, we can confirm that they have been loaded into
the environment using the ```search()``` function.

```{r confirm_packages, include=FALSE}
search()
```

Admittedly, we have spent a good bit of our time so far setting up and
double-checking our environment. We recommend making this a part of your
regular workflow - being explicit and careful about documenting paths within
your environment and packages used in an analysis is a key aspect of
developing reusable, reproducible workflows.

But now if everything is working, we're ready to have fun looking at
baby names!




